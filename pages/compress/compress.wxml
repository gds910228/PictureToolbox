<!--pages/compress/compress.wxml-->
<view class="container">
  <!-- ä¸Šä¼ åŒºåŸŸ -->
  <view class="upload-section" wx:if="{{!showResult}}">
    <view class="upload-box" bindtap="chooseImage">
      <text class="upload-icon">ğŸ“·</text>
      <text class="upload-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡</text>
      <text class="upload-hint">æ”¯æŒJPGã€PNGã€WebPã€GIFã€BMPç­‰æ ¼å¼</text>
    </view>

    <!-- é¢„è§ˆå›¾ -->
    <image
      wx:if="{{imageSrc}}"
      class="preview-image"
      src="{{imageSrc}}"
      mode="aspectFit"
      bindtap="previewImage"
      data-url="{{imageSrc}}"
    />
  </view>

  <!-- å‹ç¼©è®¾ç½® -->
  <view class="settings-section" wx:if="{{imageSrc && !showResult}}">
    <!-- AIåˆ†æç»“æœ -->
    <view class="ai-card" wx:if="{{showAIRecommendation && aiAnalysis}}">
      <view class="ai-header">
        <text class="ai-icon">ğŸ¤–</text>
        <text class="ai-title">AIæ™ºèƒ½åˆ†æ</text>
        <text class="ai-badge">{{aiAnalysis.imageType}}</text>
      </view>
      <view class="ai-content">
        <text class="ai-reason">{{aiAnalysis.recommendation.reason}}</text>
        <view class="ai-suggestion">
          <text class="ai-label">æ¨èè´¨é‡ï¼š</text>
          <text class="ai-value">{{aiAnalysis.recommendation.suggestedQuality}}%</text>
        </view>
        <text class="ai-tips">{{aiAnalysis.recommendation.tips}}</text>
      </view>
    </view>

    <!-- æ™ºèƒ½å‹ç¼©å¼€å…³ -->
    <view class="setting-item">
      <view class="setting-header">
        <text class="setting-label">æ™ºèƒ½å‹ç¼©</text>
        <switch
          class="switch"
          checked="{{useSmartCompress}}"
          bindchange="toggleSmartCompress"
          color="#4A90E2"
        />
      </view>
      <text class="setting-hint">è‡ªåŠ¨å¯»æ‰¾æœ€ä½³å‹ç¼©è´¨é‡ï¼Œä¿æŒç”»è´¨çš„åŒæ—¶æœ€å°åŒ–æ–‡ä»¶å¤§å°</text>
    </view>

    <!-- æ™®é€šå‹ç¼©æ¨¡å¼ -->
    <view class="setting-item" wx:if="{{!useSmartCompress}}">
      <text class="setting-label">å‹ç¼©è´¨é‡</text>
      <view class="slider-wrapper">
        <slider
          class="slider"
          min="10"
          max="100"
          value="{{quality}}"
          bindchange="onSliderChange"
          activeColor="#4A90E2"
          backgroundColor="#e0e0e0"
          block-size="20"
        />
        <text class="slider-value">{{quality}}%</text>
      </view>
    </view>

    <!-- æ™ºèƒ½å‹ç¼©æ¨¡å¼ -->
    <view class="setting-item" wx:if="{{useSmartCompress}}">
      <text class="setting-label">ç›®æ ‡æ–‡ä»¶å¤§å°ï¼ˆå¯é€‰ï¼‰</text>
      <view class="input-wrapper">
        <input
          class="size-input"
          type="number"
          placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨ä¼˜åŒ–"
          value="{{targetSizeKB}}"
          bindinput="onTargetSizeInput"
        />
        <text class="input-unit">KB</text>
      </view>
      <text class="setting-hint">è®¾ç½®æœŸæœ›çš„æ–‡ä»¶å¤§å°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒæ•´è´¨é‡è¾¾åˆ°ç›®æ ‡</text>
    </view>

    <view class="info-card">
      <view class="info-row">
        <text class="info-label">åŸå›¾å¤§å°ï¼š</text>
        <text class="info-value">{{originalSizeText}}</text>
      </view>
    </view>
  </view>

  <!-- å‹ç¼©æŒ‰é’® -->
  <button
    wx:if="{{imageSrc && !showResult}}"
    class="btn-primary"
    bindtap="startCompress"
    loading="{{compressing}}"
    disabled="{{compressing}}"
  >
    {{compressing ? 'å‹ç¼©ä¸­...' : 'å¼€å§‹å‹ç¼©'}}
  </button>

  <!-- ç»“æœå±•ç¤º -->
  <view class="result-section" wx:if="{{showResult}}">
    <view class="result-title">å‹ç¼©å®Œæˆï¼</view>

    <view class="image-comparison">
      <view class="image-item">
        <image class="result-image" src="{{imageSrc}}" mode="aspectFit" />
        <text class="image-label">åŸå›¾</text>
      </view>
      <view class="image-item">
        <image class="result-image" src="{{compressedSrc}}" mode="aspectFit" />
        <text class="image-label">å‹ç¼©å</text>
      </view>
    </view>

    <view class="result-info">
      <view class="result-card">
        <text class="result-label">åŸå›¾å¤§å°</text>
        <text class="result-size">{{originalSizeText}}</text>
      </view>
      <view class="result-card highlight">
        <text class="result-label">å‹ç¼©åå¤§å°</text>
        <text class="result-size">{{compressedSizeText}}</text>
      </view>
      <view class="result-card">
        <text class="result-label">å‹ç¼©ç‡</text>
        <text class="result-size">{{compressionRate}}</text>
      </view>
    </view>

    <button class="btn-primary" bindtap="saveImage">ä¿å­˜åˆ°ç›¸å†Œ</button>
    <button class="btn-secondary" bindtap="chooseImage">ç»§ç»­å‹ç¼©</button>
  </view>
</view>
